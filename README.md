# yara rule file searcher with ply

ply(Lex & Yacc's python version) : https://github.com/dabeaz/ply

yara rule : https://yara.readthedocs.io/en/stable/

yara grammar definition for ply is from : https://github.com/8u1a/plyara/blob/master/plyara/interp.py

use textract as text extraction library : https://github.com/deanmalmgren/textract

## How it works

It parses yara rule with lexer, parser (generated by ply) and makes AST.

And then with string variable table and texts from file, it traverses AST and applys operation of AST node, and check if
result is True.

![Moduel Dependency](/doc/img.png)

## Usage

### example

Do search from current directory (./), find all ("py", "docx") files which has all three strings (for, def, class) and
has "def" string more or equal to 3 (2+1) times.

```python
rule = '''
rule rule1
{
    strings:
       $var1 = "for"
       $var2 = "def"
       $var2 = "class"
       
    condition:
       all of them and #var2 >= (2+1)
}
'''
search.traverse(rule, "./", path_regex=".*\.(py|docx)")
```

Or, you can just use regex rule to search files.
```python
search.regex_search("Ubuntu.*File System", "./", path_regex=".*\.(py|docx)")
```

### Notics

1. PDF and image files are only supported in Ubuntu OS 
2. variable's string is case insensitive.
3. path_regex is optional
4. you can use extensions parameter for file extension rather than path_regex, which is also optional

```python
traverse.search(rule, "./", extensions=["py", "docx"])
```